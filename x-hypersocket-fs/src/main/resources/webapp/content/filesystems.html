<div id="contentFilesystems">
	<ul id="filesystemTabs">
		<li><a href="#tabMounts"><span localize="mounts.label"></span></a></li>
	</ul>
	<div id="tabMounts"></div>

	<div id="addMountForm" class="dialog" dialog-for="tabMounts">
		<form class="form">
			<div class="dialogError"></div>
			<div class="formInputField">
				<label for="resourceName" class="formLabel"
					localize="mount.name.label"></label> <input type="text"
					name="resourceName" id="resourceName"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>

			<div id="mountDetails">
				<ul id="mountTabs">
					<li><a href="#tabFile"><span
							localize="mount.details.label"></span></a></li>
					<li><a href="#tabAuth"><span localize="mount.auth.label"></span></a></li>
					<li><a href="#tabOptions"><span
							localize="mount.options.label"></span></a></li>
					<li><a href="#roles"><span localize="mount.roles.label"></span></a></li>
				</ul>

				<div id="tabFile" class="dialogTab">
					<div class="formInputField">
						<label for="scheme" class="formLabel" localize="mount.scheme.label"></label>
						<select name="scheme" id="scheme"
							class="formInput text ui-widget-content ui-corner-all">
						</select>
					</div>
					<div class="formInputField remoteDiv">
						<label for="server" class="formLabel"
							localize="mount.server.label"></label> <input type="text"
							name="server" id="server"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
					<div class="formInputField remoteDiv">
						<label for="port" class="formLabel" localize="mount.port.label"></label>
						<input type="text" name="port" id="port"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
					<div class="formInputField">
						<label for="path" class="formLabel" localize="mount.path.label"></label>
						<input type="text" name="path" id="path"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>

				</div>
				<div id="tabAuth" class="dialogTab">
					<div class="formInputField credsDiv">
						<label for="username" class="formLabel"
							localize="mount.username.label"></label> <input type="text"
							name="username" id="username"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
					<div class="formInputField credsDiv">
						<label for="password" class="formLabel"
							localize="mount.password.label"></label> <input type="password"
							name="password" id="password"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
				</div>
				<div id="tabOptions" class="dialogTab">
					<div class="formInputField">
						<label for="readOnly" class="formLabel"
							localize="mount.readOnly.label"></label> <input type="checkbox"
							name="readOnly" id="readOnly"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
					<div class="formInputField">
						<label for="showHidden" class="formLabel"
							localize="mount.showHidden.label"></label> <input type="checkbox"
							name="showHidden" id="showHidden"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
					<div class="formInputField">
						<label for="showFolders" class="formLabel"
							localize="mount.showFolders.label"></label> <input type="checkbox"
							name="showFolders" id="showFolders"
							class="formInput text ui-widget-content ui-corner-all" />
					</div>
				</div>
				<div id="roles" class="dialogTab">
				</div>
			</div>
			<input type="hidden" id="resourceId" name="resourceId" value="" />
		</form>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(
			function() {
				$('#contentFilesystems').localize();
				$('#contentFilesystems').tabs();
				
				getJSON('schemes', null, function(data) {
					
					
					$.each(data.resources, function() {
						$('#scheme').append(
								'<option id="' + this.scheme + 'Scheme" value="' + this.scheme + '\">'
										+ getResource("mount." + this.scheme
												+ '.label') + '</option>');
						$('#' + this.scheme + 'Scheme').data('scheme', this);
					});
					
					$('#scheme').change(function() {
						var option = $("#scheme option:selected");
						var scheme = option.data('scheme');
						if(scheme.remote) {
							$('.remoteDiv').show();
							
						} else {
							$('.remoteDiv').hide();
							$('#server').val('');
							$('#port').val('');
						}
						if(scheme.supportsCredentials) {
							if(getResourceNoDefault(scheme.scheme + '.username.label')!=null) {
								$("label[for='username']").text(getResource(scheme.scheme + '.username.label'));
							} else {
								$("label[for='username']").text(getResource('mount.username.label'));
							}
							if(getResourceNoDefault(scheme.scheme + '.password.label')!=null) {
								$("label[for='password']").text(getResource(scheme.scheme + '.password.label'));
							} else {
								$("label[for='password']").text(getResource('mount.password.label'));
							}
							$('.credsDiv').show();
						} else {
							$('.credsDiv').hide();
							$('#username').val('');
							$('#password').val('');
						}
					});
					
					$('#scheme').trigger('change');
				});
				
				if(currentMenu.canCreate || currentMenu.canUpdate) {
					getJSON('roles', null, function(data) {
						$('#roles').multipleSelect({
							values : data.resources,
							selectedIsObjectList : true,
							resourceKey : 'mount'
						});
					});
				}

				$('#tabMounts').resourcePage(
						{
							id : "Mounts",
							tableUrl : "mounts",
							resourceUrl : "mount",
							fields : [ {
								name : "name"
							}, {
								name : "scheme",
								isResourceKey : true
							}, {
								name : "url"
							} ],
							resourceKey : "mount",
							canCreate: currentMenu.canCreate,
							canUpdate: currentMenu.canUpdate,
							canDelete: currentMenu.canDelete,
							additionalActions : [ { resourceKey: "openMount",
								iconClass: "ui-icon-folder-open",
								enabled: true,
								action : function(resource) {
									window.open('viewfs/' + resource.name,
											'_blank',
											'width=800,height=600,toolbar=0,menubar=0,location=1,status=1,scrollbars=1,resizable=1,left=0,top=0');
								}}],
							validate : function() {

								if ($('#resourceName').val() == '') {
									$('#addResourceForm').resourceDialog(
											'error', "error.nameRequired");
									return false;
								}

								if ($('#server').val() != '') {
									if (!isValidHostname($('#server').val())) {
										$('#addResourceForm').resourceDialog(
												'error', "error.hostnameInvalid");
										return false;
									}
								}

								return true;
							},
							clearDialog : function() {
								
								$('#mountDetails').tabs('option', 'active', 0);
								$('#scheme').prop('disabled', false);
								$('#scheme').val('file');
								$('#scheme').trigger('change');
								$('#resourceId').val('');
								$('#resourceName').val('');
								
								$('#server').val('');
								$('#port').val('');
								$('#path').val('');
								
								$('#username').val('');
								$('#password').val('');
								
								$('#readOnly').prop('checked', false);
								$('#showHidden').prop('checked', false);
								$('#showFolders').prop('checked', true);
								
								$('#roles').multipleSelect();
							},
							createResource : function() {
								resource = new Object();
								resource.id = $('#resourceId').val();
								resource.name = $('#resourceName').val();
								resource.scheme = $('#scheme').val();
								resource.server = $('#server').val();
								resource.port = $('#port').val();
								resource.path = $('#path').val();
								resource.username = $('#username').val();
								resource.password = $('#password').val();
								resource.readOnly = $('#readOnly').prop('checked') ? true : false;
								resource.showHidden = $('#showHidden').prop('checked') ? true : false;
								resource.showFolders = $('#showFolders').prop('checked') ? true : false;
								
								resource.roles = $('#roles').multipleSelectValues();
								
								return resource;
							},
							displayResource : function(resource) {
								
								$('#resourceId').val(resource.id);
								$('#resourceName').val(resource.name);
								$('#scheme').val(resource.scheme);
								$('#scheme').trigger('change');
								$('#scheme').prop('disabled', true);
								$('#server').val(resource.server);
								$('#port').val(resource.port);
								$('#path').val(resource.path);
								$('#username').val(resource.username);
								$('#password').val(resource.password);
								if(resource.readOnly) {
									$('#readOnly').prop('checked', true);
								}
								if(resource.showHidden) {
									$('#showHidden').prop('checked', true);
								}
								if(resource.showFolders) {
									$('#showFolders').prop('checked', true);
								}
								$('#roles').multipleSelect({
									selected : resource.roles,
									selectedIsObjectList : true,
									resourceKey : 'mount'
								});
							},
							complete : function() {

								$('#mountDetails').tabs();

								loadComplete();
							}
						});
			});
</script>