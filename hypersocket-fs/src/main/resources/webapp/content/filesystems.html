<div id="tabMounts">

	<div class="modal" id="addMountForm" tabindex="-1" role="dialog" dialog-for="tabMounts">
		<div class="modal-dialog" style="width: 740px;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.name.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control"
									placeholder="" id="resourceName" maxlength="" name="resourceName" value="">
								<div>
									<span class="help-block" localize="mount.name.info"></span>
								</div>
							</div>
						</div>
						
						<div id="mountProperties"></div>
						<div id="tabFile" class="dialogTab">
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.scheme.label"></label>
							<div class="propertyValue col-md-9">
								<div id="schemeButton"></div>
								<div>
									<span class="help-block" localize="mount.scheme.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group remoteDiv">
							<label for="server" class="col-md-3 control-label" localize="mount.server.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control"
									placeholder="" id="serverName" maxlength="" name="server" value="">
								<div>
									<span class="help-block" localize="mount.server.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group remoteDiv portDiv">
							<label class="col-md-3 control-label" localize="mount.port.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control"
									placeholder="" id="port" maxlength="" name="port" value="">
								<div>
									<span class="help-block" localize="mount.port.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.path.label"></label>
							<div class="propertyValue col-md-9">
								<div id="pathField"></div>
								<div>
									<span class="help-block" localize="mount.path.info"></span>
								</div>
							</div>
						</div>						
					</div>
					<div id="tabAuth" class="dialogTab">
					
						<div class="propertyItem form-group credsDiv">
							<label for="username" class="col-md-3 control-label" localize="mount.username.label"></label>
							<div class="propertyValue col-md-9">
								<div id="usernameField"></div>
								<div>
									<span class="help-block" localize="mount.username.info"></span>
								</div>
							</div>
						</div>	
						<div class="propertyItem form-group credsDiv">
							<label for="password" class="col-md-3 control-label" localize="mount.password.label"></label>
							<div class="propertyValue col-md-9">
								<div id="passwordField"></div>
								<div>
									<span class="help-block" localize="mount.password.info"></span>
								</div>
							</div>
						</div>	
					</div>
					<div id="tabOptions" class="dialogTab">
						<div class="propertyItem">
							<label for="readOnly" class="col-md-3 control-label" 
								localize="mount.readOnly.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
									name="readOnly" id="readOnly" />
								<div>
									<span class="help-block" localize="mount.readOnly.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="showHidden" class="col-md-3 control-label" 
								localize="mount.showHidden.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
								name="showHidden" id="showHidden"/>
								<div>
									<span class="help-block" localize="mount.showHidden.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="showFolders" class="col-md-3 control-label" 
								localize="mount.showFolders.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
								name="showFolders" id="showFolders" />
								<div>
									<span class="help-block" localize="mount.showFolders.info"></span>
								</div>
							</div>
						</div>
					</div>
					<div id="tabLogo" class="dialogTab">
						<div class="propertyItem">
							<label for="logo" class="col-md-3 control-label" 
								localize="mount.logo.label"></label> 
							<div class="propertyValue col-md-9">
								<div id="logo"></div>
								<div>
									<span class="help-block" localize="mount.logo.info"></span>
								</div>
							</div>
						</div>
					</div>
					<div id="tabRoles" class="dialogTab">
					<input type="hidden" id="resourceId" name="resourceId" value="" />
				</div>
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>

</div>

<script type="text/javascript">
	$(document).ready(function() {
				$('#tabMounts').localize();
				
				var usernameInput = $('#usernameField').textInput({
					id: 'username',
					url: 'realms/realm/userVariables/' + $(document).data('session').currentRealm.id,
					getUrlData: function(data) {
						return data.resources;
					}
				});
				
				var pathInput = $('#pathField').textInput({
					id: 'path',
					url: 'realms/realm/userVariables/' + $(document).data('session').currentRealm.id,
					getUrlData: function(data) {
						return data.resources;
					}
				});
				
				var passwordInput = $('#passwordField').textInput({
					id: 'password',
					inputType: 'password',
					url: 'realms/realm/userVariables/' + $(document).data('session').currentRealm.id,
					getUrlData: function(data) {
						data.resources.push('password');
						return data.resources;
					}
				});
				
				var schemeButton = $('#schemeButton').selectButton({
					id: 'scheme',
					url: 'mounts/schemes',
					nameAttr: 'scheme',
					valueAttr: 'scheme',
					nameIsResourceKey: true,
					resourceKeyTemplate: 'mount.{0}.label',
					name: 'file',
					value: 'file',
					getUrlData: function(data) {
						return data.resources;
					},
					changed: function(widget) {
						var scheme = widget.getSelectedObject();
						if(scheme.remote) {
							if(getResourceNoDefault(scheme.scheme + '.server.label')!=null) {
								$("label[for='server']").text(getResource(scheme.scheme + '.server.label'));
							} else {
								$("label[for='server']").text(getResource('mount.server.label'));
							}
							$('.remoteDiv').show();
							if(!scheme.showPort) {
								$('.portDiv').hide();
							}
						} else {
							$('.remoteDiv').hide();
							$('#serverName').val('');
							$('#port').val('');
						}
						if(scheme.supportsCredentials) {								
							if(getResourceNoDefault(scheme.scheme + '.username.label')!=null) {
								$("label[for='username']").text(getResource(scheme.scheme + '.username.label'));
							} else {
								$("label[for='username']").text(getResource('mount.username.label'));
							}
							if(getResourceNoDefault(scheme.scheme + '.password.label')!=null) {
								$("label[for='password']").text(getResource(scheme.scheme + '.password.label'));
							} else {
								$("label[for='password']").text(getResource('mount.password.label'));
							}
							$('.credsDiv').show();
						} else {
							$('.credsDiv').hide();
							$('#username').val('');
							$('#password').val('');
						}
					}
				});
				
				var logo = $('#logo').logoInput({
					defaultTextCallback: function() {
						return $('#resourceName').val();
					},
					typeCallback: function() {
						// Matches that used by the client so the shape/colour will be the same
						return 'FILE';
					},
					url : basePath + '/api/fileUpload/file'
				});
				$('#resourceName').on('input', function(){
					logo.defaultTextChanged();
				});
				
				if(currentMenu.canCreate || currentMenu.canUpdate) {
					getJSON('roles/list', null, function(data) {
						$('#tabRoles').multipleSelect({
							values : data.resources,
							selectedIsObjectList : true,
							resourceKey : 'mount'
						});
					});
				}
				
				$('#mountProperties').propertyPage({
					url : 'mounts/template',
					showButtons : false,
					useTemplates : true,
					canUpdate : currentMenu.canUpdate,
					additionalTabs : [ {
						id : "tabFile",
						name : getResource("mount.details.label")
					},
					{
						id : "tabAuth",
						name : getResource("mount.auth.label")
					},
					{
						id : "tabOptions",
						name : getResource("mount.options.label")
					},
					{
						id : "tabRoles",
						name : getResource("label.roles")
					},
					{
						id : "tabLogo",
						name : getResource("mount.logo.label")
					},]
				});

				$('#tabMounts').ajaxResourcePage(
						{
							id : "Mounts",
							tableUrl : "mounts/table",
							title: getResource("filesystems.label"),
							icon: 'fa-folder-open',
							resourceUrl : "mounts/mount",
							importUrl: 'mounts/import',
							exportUrl: 'mounts/export',
							logo: true,
							logoResourceTypeCallback: function(resource) {
								return 'FILE';
							},
							fields : [ {
								name : "name"
							}, {
								name : "scheme",
								isResourceKey : true
							}, {
								name : "url"
							} ],
							resourceKey : "mount",
							canCreate: currentMenu.canCreate,
							canUpdate: currentMenu.canUpdate,
							canDelete: currentMenu.canDelete,
							additionalActions : [ { resourceKey: "openMount",
								iconClass: "fa-folder-open-o",
								enabled: true,
								action : function(resource) {
									window.open('viewfs/' + resource.name,
											'_blank',
											'width=1024,height=800,toolbar=0,menubar=0,location=0,status=1,scrollbars=0,resizable=0,left=0,top=0');
								}}],
							validate : function() {

								if ($('#resourceName').val() == '') {
									showError("error.nameRequired");
									return false;
								}

								if ($('#serverName').val() != '') {
									if (!isValidHostname($('#serverName').val())) {
										showError("error.hostnameInvalid");
										return false;
									}
								}

								return true;
							},
							clearDialog : function() {
								
								schemeButton.enable();
								schemeButton.setValue('file');
								schemeButton.changed();
								
								$('#resourceId').val('');
								$('#resourceName').val('');
								
								$('#serverName').val('');
								$('#port').val('');
								
								pathInput.setValue('');
								usernameInput.setValue('');
								passwordInput.setValue('');
								logo.clear();
								
								$('#readOnly').prop('checked', false);
								$('#showHidden').prop('checked', false);
								$('#showFolders').prop('checked', true);
								
								$('#tabRoles').multipleSelect();
							},
							createResource : function() {
								resource = new Object();
								resource.id = $('#resourceId').val();
								resource.name = $('#resourceName').val();
								resource.scheme = schemeButton.getValue();
								resource.server = $('#serverName').val();
								resource.port = $('#port').val();
								resource.path = pathInput.getValue();
								resource.username = usernameInput.getValue();
								resource.password = passwordInput.getValue();
								resource.readOnly = $('#readOnly').prop('checked') ? true : false;
								resource.showHidden = $('#showHidden').prop('checked') ? true : false;
								resource.showFolders = $('#showFolders').prop('checked') ? true : false;
								resource.logo = logo.getValue();
								resource.roles = $('#tabRoles').multipleSelectValues();
								
								return resource;
							},
							displayResource : function(resource) {
								
								$('#resourceId').val(resource.id);
								$('#resourceName').val(resource.name);
								schemeButton.setValue(resource.scheme);
								schemeButton.disable();
								schemeButton.changed();
								$('#serverName').val(resource.server);
								$('#port').val(resource.port);
								pathInput.setValue(resource.path);
								usernameInput.setValue(resource.username);
								passwordInput.setValue(resource.password);
								
								if(resource.logo == '')
									logo.clear();
								else
									logo.setValue(resource.logo);
								if(resource.readOnly) {
									$('#readOnly').prop('checked', true);
								}
								if(resource.showHidden) {
									$('#showHidden').prop('checked', true);
								}
								if(resource.showFolders) {
									$('#showFolders').prop('checked', true);
								}
								$('#tabRoles').multipleSelect({
									selected : resource.roles,
									selectedIsObjectList : true,
									resourceKey : 'mount'
								});
							},
							complete : function() {
								loadComplete();
							}
						});

			});
</script>