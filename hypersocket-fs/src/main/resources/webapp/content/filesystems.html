<div id="tabMounts">

	<div class="modal" id="addMountForm" tabindex="-1" role="dialog" dialog-for="tabMounts">
		<div class="modal-dialog modal-lg" >
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.name.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control"
									 id="resourceName" maxlength="" name="resourceName" value="">
								<div>
									<span class="help-block" localize="mount.name.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group" style="display: none">
							<label class="col-md-3 control-label" localize="virtualPath.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control"
									 id="virtualPath" maxlength="" name="virtualPath" value="">
								<div>
									<span class="help-block" localize="mount.path.info"></span>
								</div>
							</div>
						</div>
						
						<div id="mountProperties"></div>
						<div id="tabFile" class="dialogTab">
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.scheme.label"></label>
							<div class="propertyValue col-md-9">
								<div id="schemeButton"></div>
								<div>
									<span class="help-block" localize="mount.scheme.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group remoteDiv">
							<label for="server" class="col-md-3 control-label" localize="mount.server.label"></label>
							<div class="propertyValue col-md-9">
								<div id="serverName"></div>
								<div>
									<span class="help-block" localize="mount.server.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group remoteDiv portDiv">
							<label class="col-md-3 control-label" localize="mount.port.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control"
									 id="port" maxlength="" name="port" value="">
								<div>
									<span class="help-block" localize="mount.port.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group pathDiv">
							<label class="col-md-3 control-label" localize="mount.path.label"></label>
							<div class="propertyValue col-md-9">
								<div id="pathField"></div>
								<div>
									<span class="help-block" localize="mount.path.info"></span>
								</div>
							</div>
						</div>						
					</div>
					<div id="tabAuth" class="dialogTab">
					
						<div class="propertyItem form-group credsDiv">
							<label for="username" class="col-md-3 control-label" localize="mount.username.label"></label>
							<div class="propertyValue col-md-9">
								<div id="usernameField"></div>
								<div>
									<span class="help-block" localize="mount.username.info"></span>
								</div>
							</div>
						</div>	
						<div class="propertyItem form-group credsDiv">
							<label for="password" class="col-md-3 control-label" localize="mount.password.label"></label>
							<div class="propertyValue col-md-9">
								<div id="passwordField"></div>
								<div>
									<span class="help-block" localize="mount.password.info"></span>
								</div>
							</div>
						</div>	
					</div>
					<div id="tabOptions" class="dialogTab">
						<div class="propertyItem">
							<label for="cacheStrategy" class="col-md-3 control-label" 
								localize="mount.cacheStrategy.label"></label> 
							<div class="propertyValue col-md-9">
								<div id="cacheStrategy"></div>
								<div>
									<span class="help-block" localize="mount.cacheStrategy.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="readOnly" class="col-md-3 control-label" 
								localize="mount.readOnly.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
									name="readOnly" id="readOnly" />
								<div>
									<span class="help-block" localize="mount.readOnly.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="showHidden" class="col-md-3 control-label" 
								localize="mount.showHidden.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
								name="showHidden" id="showHidden"/>
								<div>
									<span class="help-block" localize="mount.showHidden.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="showFolders" class="col-md-3 control-label" 
								localize="mount.showFolders.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
								name="showFolders" id="showFolders" />
								<div>
									<span class="help-block" localize="mount.showFolders.info"></span>
								</div>
							</div>
						</div>
					</div>
<!-- 					<div id="tabLogo" class="dialogTab"> -->
<!-- 						<div class="propertyItem"> -->
<!-- 							<label for="logo" class="col-md-3 control-label"  -->
<!-- 								localize="mount.logo.label"></label>  -->
<!-- 							<div class="propertyValue col-md-9"> -->
<!-- 								<div id="logo"></div> -->
<!-- 								<div> -->
<!-- 									<span class="help-block" localize="mount.logo.info"></span> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 						</div> -->
<!-- 					</div> -->
					<div id="tabRoles" class="dialogTab col-xs-12">
						
					</div>
				<input type="hidden" id="resourceId" name="resourceId" value="" />
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>
</div>
<div id="virtualFileSystemView">
	<div id="virtualFileSystemTree" class="col-md-4 panel panel-body">
		<div id="treeview"></div>
	</div>
	<div id="virtualFileSystemInfo" class="col-md-8 panel panel-body">
		<div id="defaultPanel" class="col-md-12">
			<p><strong>Here you can create a virtual file system for your users. To do this you can...</strong></p>
			
			<p>Build up your file system by creating <strong>Virtual Folders</strong>. These are represented in the tree 
			view as the open folder icon&nbsp;<i class="fa fa-folder-open-o"></i>. <strong>Virtual Folders</strong> act 
			as a point to mount your external files. Each folder can contain any
			number of mounts. If you mount an external folder then the files within that folder are included in the 
			listing of the virtual folder. Similarly you can mount a single file to be included in the Virtual Folder.</p>
			<p>Right click on a Virtual Folder in the tree view to access the context menu.</p>
			<p><img src="${uiPath}/content/images/virtualFolderMenu.png" height="75"></p>

			<p><strong>Mount</strong> any number of external file systems to your Virtual Folders. These are represented 
			in the tree	view as the disk icon&nbsp;<i class="fa fa-hdd-o"></i>.	<strong>Mounts</strong> are assignable to 
			Roles so only users within those Roles will be able to see and access the files within it.</p>
			<p>After you have created a Mount right click on its icon in the tree view to access its context menu.</p>
			<p><img src="${uiPath}/content/images/mountMenu.png" height="75"></p>
			
			<p>Some other things to note about the file system...</p>

			<p><i class="fa fa-hand-o-right"></i> A Virtual Folder at the top most level is read-only by default. Folders beneath the Virtual Folder declared by
			Mounts will have the permissions of the mount. You can set the Default Mount property of the Virtual Folder to 
			enable uploads and folder creation within the Virtual Folder. These operations will be performed on the Mount selected.</p>
		
			<p><i class="fa fa-hand-o-right"></i> When multiple Mounts are defined on a single Virtual Folder its possible that there could be conflicting filenames.
			In this case the first Mount to declare a filename wins and all other files are marked as conflicted and will not be
			accessible. 
			</p>
		</div>
		<div id="folderPanel" class="col-md-12" style="display: none">
			<div class="col-md-4">
				<h4>Folder Name:</h4>
				<h4>Virtual Path:</h4>
				<h4>Default Mount:</h4>
			</div>
			<div class="col-md-8">
				<h4><span id="infFolderName"></span></h4>
				<h4><span id="infFolderPath"></span></h4>
				<div id="defaultMounts"></div>
			</div>		
		</div>
		<div id="mountPanel" class="col-md-12" style="display: none">
			<div class="col-md-4">
				<h4>Resource Name:</h4>
				<h4>Virtual Path:</h4>
				<h4>Last Modified:</h4>
				<h4>Scheme:</h4>
			</div>
			<div class="col-md-8">
				<h4><span id="infResourceName"></span></h4>
				<h4><span id="infVirtualPath"></span></h4>
				<h4><span id="infLastReconcile"></span></h4>
				<h4><span id="infScheme"></span></h4>
			</div>	
		</div>
	</div>
	<div class="clear"></div>
</div>
<script type="text/javascript">

	function displayScheme(scheme, url, create) {
		if(scheme.remote) {
			if(getResourceNoDefault(scheme.scheme + '.server.label')!=null) {
				$("label[for='server']").text(getResource(scheme.scheme + '.server.label'));
			} else {
				$("label[for='server']").text(getResource('mount.server.label'));
			}
			$('.remoteDiv').show();
			
			if(!scheme.showPort) {
				$('.portDiv').hide();
			} else {
				$('.portDiv').show();
				if(create) {
					$('#port').val(scheme.defaultPort);
				}
			}
		} else {
			$('.remoteDiv').hide();
			$('#serverName').widget().setValue('');
			$('#port').val('');
		}
		if(scheme.supportsCredentials) {	
			
			if(getResourceNoDefault(scheme.scheme + '.username.label')!=null) {
				$("label[for='username']").text(getResource(scheme.scheme + '.username.label'));
			} else {
				$("label[for='username']").text(getResource('mount.username.label'));
			}
			if(getResourceNoDefault(scheme.scheme + '.username.info')!=null) {
				$("span[localize='mount.username.info']").text(getResource(scheme.scheme + '.username.info'));
			} else {
				$("span[localize='mount.username.info']").text(getResource('mount.username.info'));
			}
			if(getResourceNoDefault(scheme.scheme + '.password.label')!=null) {
				$("label[for='password']").text(getResource(scheme.scheme + '.password.label'));
			} else {
				$("label[for='password']").text(getResource('mount.password.label'));
			}
			if(getResourceNoDefault(scheme.scheme + '.password.info')!=null) {
				$("span[localize='mount.password.info']").text(getResource(scheme.scheme + '.password.info'));
			} else {
				$("span[localize='mount.password.info']").text(getResource('mount.password.info'));
			}
			$('.credsDiv').show();
		} else {
			
			$('.credsDiv').hide();
			$('#username').val('');
			$('#password').val('');
		}
		
		if(scheme.showPath) {
			$('.pathDiv').show();
		} else {
			$('.pathDiv').hide();
		}
		
		$('#readOnly').prop('checked', scheme.readOnly);
		$('#readOnly').prop('disabled', scheme.readOnly);
		
		$('#showHidden').prop('checked', false);
		$('#showHidden').prop('disabled', !scheme.showHidden);
		
		$('#showFolders').prop('checked', scheme.showFolders);
		$('#showFolders').prop('disabled', !scheme.showFolders);
		
		$('#mountProperties').propertyPage({
			url : 'mounts/' + url,
			showButtons : false,
			useTemplates : true,
			canUpdate : currentMenu.canUpdate,
			additionalTabs : [ {
				id : "tabFile",
				name : getResource("mount.details.label")
			},
			{
				id : "tabAuth",
				name : getResource("mount.auth.label"),
				checkDisplay: function() {
					return scheme.supportsCredentials;
				}
			},
			{
				id : "tabOptions",
				name : getResource("mount.options.label")
			},
			{
				id : "tabRoles",
				name : getResource("label.roles")
			}
			]
		});
	}
	
	$(document).ready(function() {
	
		$('#treeview').on('rename_node.jstree', function(node, data){
		    var oldText = data.old;
		    var newText = data.text;
		    getJSON('fs/rename' + data.node.original.virtualPath + "?toUri=" + basePath + "/api/fs/rename" + data.node.original.parentPath + newText, null, function(data) {
				 if(!data.success) {
					 showError(data.message);
				 }
				 var ref = $('#treeview').jstree(true);
				 ref.refresh(); 
			  }, function() {
				  var ref = $('#treeview').jstree(true);
				  ref.refresh();
				 return true;
		      });
		});
		
		$('.jstree-leaf').on('dblclick', function(){
			$('#treeview').jstree("edit");
		});
		
		var tree = $('#treeview').jstree({
			  "core" : {
			    "animation" : 0,
			    "multiple" : false,
			    "check_callback" : function (operation, node, node_parent, node_position, more) {
	                switch (operation) {
	                    case "move_node":
	                        return false;
	                        break;
	                    case "copy_node":
	                        return false;
	                        break;
	                    case "create_node":
	                        return operation === 'create_node' ? true : false;
	                        break;
	                    case "rename_node":
	                    	return node_parent.id ==='#' ? false : true;
	                    default:
							break;
	                }
	            },
			    "themes" : { "stripes" : false },
			    'data' : function(obj, cb) {
		    		getJSON(basePath + '/api/fs/tree', null, function(data) {
		    			cb.call(this, data);
		    		});
	    		} 
			  }, "types" : {
			        "mount" : {
			          "icon" : "fa fa-2x fa-hdd-o"
			        },
			        "default" : {
				          "icon" : "fa fa-2x fa-folder-open-o"
				        }
			  }, 
			  "contextmenu": {
				  "items": function(node, callback) {

					  if(node.original.type==='mount') {
						  callback([						    
						    {
							label: getResource("text.edit"),
						     action: function() {
						    	$(document).data('virtualPath', node.original.virtualPath);
 								getJSON('mounts/mount/' + node.original.resourceId, null, function(data) {
 									resourcePage.showEdit(data.resource);
 								});
						     }
						  },
						  {
					    	label: getResource("text.delete"),
						    action: function() {
						    	getJSON('mounts/mount/' + node.original.resourceId, null, function(data) {
						    		resourcePage.deleteResource(data.resource);
								});
					        }
						  }]);
					  } else if(node.original.fileType==='ROOT') { 
						  callback([{
							  label: getResource("mountFiles.text"),
							  action: function() {
								  $(document).data('virtualPath', '/');
								  resourcePage.showCreate();
							  }
						  },{
							  label: getResource("createFolder.text"),
							  action: function() {
								  getJSON('fs/createVirtualFolder' + node.original.virtualPath, null, function(data) {
									  if(data.success) {
										  var ref = $('#treeview').jstree(true);
										  ref.refresh();
									  } else {
										  showError(data.message);
									  }
								  });
							  }
						  }]);
					  } else {
						  
						  var items = [{
							  label: getResource("mountFiles.text"),
							  action: function() {
								  $(document).data('virtualPath', node.original.virtualPath);
								  resourcePage.showCreate();
							  }
						  },{
							  label: getResource("createFolder.text"),
							  action: function() {
								  getJSON('fs/createVirtualFolder' + node.original.virtualPath, null, function(data) {
									  if(data.success) {
										  var ref = $('#treeview').jstree(true);
										  ref.refresh();
									  } else {
										  showError(data.message);
									  }
								  });
							  }
						  }];
						  if(node.children.length == 0) {
							  items.push({
								  label: getResource("text.rename"),
								  action: function() {
									var ref = $('#treeview').jstree(true);
									sel = ref.get_selected();
									if(!sel.length) { return false; }
									sel = sel[0];
									ref.edit(sel);
								  }
							  });
							  items.push({
							  label: "Delete",
							  action: function() {
								  getJSON('fs/delete' + node.original.virtualPath, null, function(data) {
									  if(data.success) {
										  var ref = $('#treeview').jstree(true);
										  ref.refresh();
									  } else {
										  showError(data.message);
									  }
								  });
							  }
						  	});	
						  }
						  
						  callback(items);
					  }
					  
				  }
			  },
			  "plugins" : [
			      "contextmenu", "crrm", "types"
			  ]
		});
		
		$('#treeview').on('changed.jstree', function (e, selected) {
			if(!selected || !selected.node) {
				return;
			}
		    if(selected.node.original.type === 'mount') {
				getJSON('mounts/mount/' + selected.node.original.resourceId, null, function(data) {

					if(!data.success) {
						showError(data.message);
					} else {
						$('#infResourceName').text(data.resource.name);
				    	$('#infVirtualPath').text(data.resource.virtualPath);
				    	$('#infLastReconcile').text(new Date(data.resource.modifiedDate).format("ddd d mmm yyyy, HH:MM"));
				    	$('#infScheme').text(getResource('mount.' + data.resource.scheme + '.label'));
				    	$('#mountPanel').show();
				    	$('#defaultPanel').hide();
				    	$('#folderPanel').hide();
					}
				});
		    	
		    } else {
		    	
		    	getJSON('fs/mountsByPath' + selected.node.original.virtualPath, null, function(data) {

		    		if(!data.success) {
		    			showError(data.message);
		    		} else {
		    			getJSON('fs/file/' + selected.node.original.resourceId, null, function(file) {

				    		$('#infFolderName').text(file.resource.filename);
					    	$('#infFolderPath').text(file.resource.virtualPath);
					    	$('#defaultMounts').empty();
					    	var writableMounts = [];
					    	$.each(data.resources, function(idx, obj) {
					    		if(!obj.readOnly && !obj.system) {
					    			writableMounts.push(obj);
					    		}
					    	});
					    	configuring = true;
					    	
					    	$('#defaultMounts').selectButton({
					    		options: writableMounts,
					    		value: (file.resource.defaultMount ? file.resource.defaultMount.id : 0),
					    		emptySelectionAllowed: true,
					    		notSetResourceKey: 'text.noDefault',
					    		nameAttr: "name",
					    		valueAttr: "id",
					    		changed: function(widget) {
					    			
					    			if(!configuring) {
										var mount = widget.getSelectedObject();
						    			getJSON('fs/setDefaultMount/' + selected.node.original.resourceId + '/' + (mount ? mount.id : 0), null, function(data) {
						    				if(!data.success) {
						    					showError(data.message);
						    					widget.setValue((file.resource.defaultMount ? file.resource.defaultMount.id : 0));
						    				}
						    			});
					    			}
					    			configuring = false;
					    		}
					    	});
					    	$('#folderPanel').show();
					    	$('#defaultPanel').hide();
					    	$('#mountPanel').hide();
		    			});
		    		}
		    	});
		    	
		    }
		});
		
		$('#tabMounts').localize();
		
		var usernameInput = $('#usernameField').textInput({
			id: 'username',
			url: 'currentRealm/user/variableNames',
			getUrlData: function(data) {
				return data.resources;
			}
		});
		
		var serverInput = $('#serverName').textInput({
			id: 'server',
			url: 'currentRealm/user/variableNames',
			getUrlData: function(data) {
				return data.resources;
			}
		});
		
		var pathInput = $('#pathField').textInput({
			id: 'path',
			url: 'currentRealm/user/variableNames',
			getUrlData: function(data) {
				return data.resources;
			}
		});
		
		var passwordInput = $('#passwordField').textInput({
			id: 'password',
			inputType: 'password',
			url: 'currentRealm/user/variableNames',
			getUrlData: function(data) {
				data.resources.push('password');
				return data.resources;
			}
		});
		
		var schemeButton = $('#schemeButton').selectButton({
			id: 'scheme',
			url: 'mounts/schemes',
			nameAttr: 'scheme',
			valueAttr: 'scheme',
			nameIsResourceKey: true,
			resourceKeyTemplate: 'mount.{0}.label',
			name: 'file',
			value: 'file',
			getUrlData: function(data) {
				return data.resources;
			},
			changed: function(widget) {
				var scheme = widget.getSelectedObject();
				
				displayScheme(scheme,'template/' + (scheme && scheme.scheme ? scheme.scheme : 'file'), true);
			}
		});
		
		var cacheStrategyButton = $('#cacheStrategy').selectButton({
			id : 'cacheStrategy',
			options : [ 
				{
					id : 'MANUAL',
					name : 'MANUAL',
					value : 'MANUAL'
				}, 
				{
					id : 'ON_RESOLVE',
					name : 'ON_RESOLVE',
					value : 'ON_RESOLVE'
				},
				{
					id : 'ON_CALL',
					name : 'ON_CALL',
					value : 'ON_CALL'
				}
				],
				nameIsResourceKey : false,
				name : 'cacheStrategy',
				value : 'MANUAL'
		});
		cacheStrategyButton.setValue('MANUAL');
		
		var logo = $('#logo').logoInput({
			defaultTextCallback: function() {
				return $('#resourceName').val();
			},
			typeCallback: function() {
				// Matches that used by the client so the shape/colour will be the same
				return 'FILE';
			},
			url : basePath + '/api/files/file'
		});
		
		$('#resourceName').on('input', function(){
			logo.defaultTextChanged();
		});
		
		$('#tabRoles').roles();
	
		var refreshFunc = function() {
			var ref = $('#treeview').jstree(true);
			ref.refresh(); 
		};
		
		var resourcePage = $('#tabMounts').ajaxResourcePage(
				{
					id : "Mounts",
					tableUrl : "mounts/table",
					title: getResource("filesystems.label"),
					infoHtml: getResource('filesystems.infoHtml'),
					icon: 'fa-folder-open',
					resourceUrl : "mounts/mount",
					importUrl: 'mounts/import',
					exportUrl: 'mounts/export',
					logo: true,
					logoResourceTypeCallback: function(resource) {
						return 'FILE';
					},
					fields : [ {
						name : "name",
						sortable: true
					}, {
						name : "scheme",
						isResourceKey : true,
						sortable: true
					}, {
						name : "url"
					} ],
					resourceKey : "mount",
					canCreate: currentMenu.canCreate,
					canUpdate: currentMenu.canUpdate,
					canDelete: currentMenu.canDelete,
					validate : function() {

						if ($('#resourceName').val() == '') {
							showError("error.nameRequired");
							return false;
						}

						if ($('#serverName').widget().getValue() != '') {
							if(!isReplacementVariable($('#serverName').widget().getValue())) {
								if (!isValidHostname($('#serverName').widget().getValue())) {
									showError("error.hostnameInvalid");
									return false;
								}
							}
						}

						return true;
					},
					clearDialog : function(isCreate) {
						
						schemeButton.enable();
						schemeButton.setValue('file');
						cacheStrategyButton.setValue('MANUAL');
						
					    if(isCreate) {
					    	schemeButton.changed();
					    }
						$('#resourceId').val('');
						$('#resourceName').val('');
						$('#virtualPath').val('');
						$('#virtualPath').attr('disabled', false);
						
						if($(document).data('virtualPath')!=null) {
							$('#virtualPath').val($(document).data('virtualPath'));
							$(document).data('virtualPath', null);
							$('#virtualPath').attr('disabled', true);
							
						}
						$('#serverName').widget().setValue('');
						$('#port').val('');
						
						$('.remoteDiv').hide();
						$('.credsDiv').hide();
						
						pathInput.setValue('');
						usernameInput.setValue('');
						passwordInput.setValue('');
						logo.clear();
						
						$('#readOnly').prop('checked', false);
						$('#showHidden').prop('checked', false);
						$('#showFolders').prop('checked', true);
						
						$('#tabRoles').widget().clear();
						if((isCreate && currentMenu.canCreate) || (!isCreate && currentMenu.canUpdate)) {
							$('#tabRoles').widget().enable();
						} else {
							$('#tabRoles').widget().disable();
						}
						
						$('.tabPropertiesTab').first().trigger('click');
						
					},
					createResource : function() {
						resource = new Object();
						resource.id = $('#resourceId').val();
						resource.name = $('#resourceName').val();
						resource.virtualPath = $('#virtualPath').val();
						resource.scheme = schemeButton.getValue();
						resource.cacheStrategy = cacheStrategyButton.getValue();
						resource.server = $('#serverName').widget().getValue();
						resource.port = $('#port').val();
						resource.path = pathInput.getValue();
						resource.username = usernameInput.getValue();
						resource.password = passwordInput.getValue();
						resource.readOnly = $('#readOnly').prop('checked') ? true : false;
						resource.showHidden = $('#showHidden').prop('checked') ? true : false;
						resource.showFolders = $('#showFolders').prop('checked') ? true : false;
						resource.logo = logo.getValue();
						resource.roles = $('#tabRoles').widget().getValue();
						
						$('#mountProperties').saveProperties(true, function(items) {
							resource.properties = items;
						});
						return resource;
					},
					displayResource : function(resource, readOnly) {
						
						schemeButton.setValue(resource.scheme);
						var scheme = schemeButton.getSelectedObject();
						displayScheme(scheme,'properties/' + resource.id);
						
						$('#resourceId').val(resource.id);
						$('#resourceName').val(resource.name);
						$('#virtualPath').val(resource.virtualPath);
						
						$('#serverName').widget().setValue(resource.server);
						$('#port').val(resource.port);
						
						cacheStrategyButton.setValue(resource.cacheStrategy);
						pathInput.setValue(resource.path);
						usernameInput.setValue(resource.username);
						passwordInput.setValue(resource.password);
						
						if(resource.logo == '') {
							logo.clear();
						} else {
							logo.setValue(resource.logo);
						}

						$('#readOnly').prop('checked', resource.readOnly);
						$('#showHidden').prop('checked', resource.showHidden);
						$('#showFolders').prop('checked', resource.showFolders);
						
						$('#tabRoles').widget().setValue(resource.roles);
						
						if(readOnly) {
							$('#tabRoles').widget().disable();
						} 
						
						schemeButton.disable();
					},
					resourceUpdated: refreshFunc,
					resourceCreated: refreshFunc,
					resourceDeleted: refreshFunc,
					additionalViews: [ { name: "VirtualFileSystem",
						id: 'folder',
						div: '#virtualFileSystemView',
						icon: 'fa-folder-open-o',
						onShow: function() {
							$('.fixed-table-toolbar').hide();
							$('.fixed-table-pagination').remove();
							$('#tabMountsActions').hide();
						},
						onHide: function() {
							
						}
					}], 
					defaultView: 'folder',
					complete : function() {
						loadComplete();
					}
				});
			});
</script>