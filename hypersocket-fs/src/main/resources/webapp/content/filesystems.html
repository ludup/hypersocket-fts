<div id="tabMounts">

	<div class="modal" id="addMountForm" tabindex="-1" role="dialog" dialog-for="tabMounts">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
					<div class="dialogError"></div>

						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.name.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control propertyInput"
									placeholder="" id="resourceName" maxlength="" name="resourceName" value="">
								<div>
									<span class="help-block" localize="mount.name.info"></span>
								</div>
							</div>
						</div>
						
						<div id="mountProperties"></div>
						<div id="tabFile" class="dialogTab">
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.scheme.label"></label>
							<div class="propertyValue col-md-9">
								<div id="schemeButton"></div>
								<div>
									<span class="help-block" localize="mount.scheme.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group remoteDiv">
							<label class="col-md-3 control-label" localize="mount.server.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control propertyInput"
									placeholder="" id="server" maxlength="" name="server" value="">
								<div>
									<span class="help-block" localize="mount.server.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group remoteDiv">
							<label class="col-md-3 control-label" localize="mount.port.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control propertyInput"
									placeholder="" id="port" maxlength="" name="port" value="">
								<div>
									<span class="help-block" localize="mount.port.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="mount.path.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control propertyInput"
									placeholder="" id="path" maxlength="" name="path" value="">
								<div>
									<span class="help-block" localize="mount.path.info"></span>
								</div>
							</div>
						</div>						
					</div>
					<div id="tabAuth" class="dialogTab">
					
						<div class="propertyItem form-group credsDiv">
							<label class="col-md-3 control-label" localize="mount.username.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" class="form-control propertyInput"
									placeholder="" id="username" maxlength="" name="username" value="">
								<div>
									<span class="help-block" localize="mount.username.info"></span>
								</div>
							</div>
						</div>	
						<div class="propertyItem form-group credsDiv">
							<label class="col-md-3 control-label" localize="mount.password.label"></label>
							<div class="propertyValue col-md-9">
								<input type="password" class="form-control propertyInput"
									placeholder="" id="password" maxlength="" name="password" value="">
								<div>
									<span class="help-block" localize="mount.username.info"></span>
								</div>
							</div>
						</div>	
					</div>
					<div id="tabOptions" class="dialogTab">
						<div class="propertyItem">
							<label for="readOnly" class="col-md-3 control-label" 
								localize="mount.readOnly.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
									name="readOnly" id="readOnly" />
								<div>
									<span class="help-block" localize="mount.readOnly.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="showHidden" class="col-md-3 control-label" 
								localize="mount.showHidden.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
								name="showHidden" id="showHidden"/>
								<div>
									<span class="help-block" localize="mount.showHidden.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem">
							<label for="showFolders" class="col-md-3 control-label" 
								localize="mount.showFolders.label"></label> 
							<div class="propertyValue col-md-9">
								<input type="checkbox"
								name="showFolders" id="showFolders" />
								<div>
									<span class="help-block" localize="mount.showFolders.info"></span>
								</div>
							</div>
						</div>
					</div>
					<div id="tabRoles" class="dialogTab">
					<input type="hidden" id="resourceId" name="resourceId" value="" />
				</div>
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>

</div>

<script type="text/javascript">
	$(document).ready(function() {
				$('#tabMounts').localize();
					
				$('#schemeButton').selectButton({
					id: 'scheme',
					url: 'schemes',
					nameAttr: 'scheme',
					valueAttr: 'scheme',
					nameIsResourceKey: true,
					resourceKeyTemplate: 'mount.{0}.label',
					name: 'file',
					value: 'file',
					changed: function(scheme) {
						debugger;
						if(scheme.remote) {
							$('.remoteDiv').show();
							
						} else {
							$('.remoteDiv').hide();
							$('#server').val('');
							$('#port').val('');
						}
						if(scheme.supportsCredentials) {
							if(getResourceNoDefault(scheme.scheme + '.username.label')!=null) {
								$("label[for='username']").text(getResource(scheme.scheme + '.username.label'));
							} else {
								$("label[for='username']").text(getResource('mount.username.label'));
							}
							if(getResourceNoDefault(scheme.scheme + '.password.label')!=null) {
								$("label[for='password']").text(getResource(scheme.scheme + '.password.label'));
							} else {
								$("label[for='password']").text(getResource('mount.password.label'));
							}
							$('.credsDiv').show();
						} else {
							$('.credsDiv').hide();
							$('#username').val('');
							$('#password').val('');
						}
					}
				});

				
				if(currentMenu.canCreate || currentMenu.canUpdate) {
					getJSON('roles', null, function(data) {
						$('#tabRoles').multipleSelect({
							values : data.resources,
							selectedIsObjectList : true,
							resourceKey : 'mount'
						});
					});
				}
				
				$('#mountProperties').propertyPage({
					url : 'template/mount',
					showButtons : false,
					useTemplates : true,
					canUpdate : currentMenu.canUpdate,
					additionalTabs : [ {
						id : "tabFile",
						name : getResource("mount.details.label")
					},
					{
						id : "tabAuth",
						name : getResource("mount.auth.label")
					},
					{
						id : "tabOptions",
						name : getResource("mount.options.label")
					},
					{
						id : "tabRoles",
						name : getResource("label.roles")
					}]
				});

				$('#tabMounts').ajaxResourcePage(
						{
							id : "Mounts",
							tableUrl : "table/mounts",
							title: getResource("filesystems.label"),
							icon: 'fa-folder-open',
							resourceUrl : "mount",
							fields : [ {
								name : "name"
							}, {
								name : "scheme",
								isResourceKey : true
							}, {
								name : "url"
							} ],
							resourceKey : "mount",
							canCreate: currentMenu.canCreate,
							canUpdate: currentMenu.canUpdate,
							canDelete: currentMenu.canDelete,
// 							additionalActions : [ { resourceKey: "openMount",
// 								iconClass: "ui-icon-folder-open",
// 								enabled: true,
// 								action : function(resource) {
// 									window.open('viewfs/' + resource.name,
// 											'_blank',
// 											'width=800,height=600,toolbar=0,menubar=0,location=1,status=1,scrollbars=1,resizable=1,left=0,top=0');
// 								}}],
							validate : function() {

								if ($('#resourceName').val() == '') {
									$('#addResourceForm').resourceDialog(
											'error', "error.nameRequired");
									return false;
								}

								if ($('#server').val() != '') {
									if (!isValidHostname($('#server').val())) {
										$('#addResourceForm').resourceDialog(
												'error', "error.hostnameInvalid");
										return false;
									}
								}

								return true;
							},
							clearDialog : function() {
								
								$('#mountDetails').tabs('option', 'active', 0);
								$('#scheme').prop('disabled', false);
								$('#scheme').val('file');
								$('#scheme').trigger('change');
								$('#resourceId').val('');
								$('#resourceName').val('');
								
								$('#server').val('');
								$('#port').val('');
								$('#path').val('');
								
								$('#username').val('');
								$('#password').val('');
								
								$('#readOnly').prop('checked', false);
								$('#showHidden').prop('checked', false);
								$('#showFolders').prop('checked', true);
								
								$('#tabRoles').multipleSelect();
							},
							createResource : function() {
								resource = new Object();
								resource.id = $('#resourceId').val();
								resource.name = $('#resourceName').val();
								resource.scheme = $('#scheme').val();
								resource.server = $('#server').val();
								resource.port = $('#port').val();
								resource.path = $('#path').val();
								resource.username = $('#username').val();
								resource.password = $('#password').val();
								resource.readOnly = $('#readOnly').prop('checked') ? true : false;
								resource.showHidden = $('#showHidden').prop('checked') ? true : false;
								resource.showFolders = $('#showFolders').prop('checked') ? true : false;
								
								resource.roles = $('#tabRoles').multipleSelectValues();
								
								return resource;
							},
							displayResource : function(resource) {
								
								$('#resourceId').val(resource.id);
								$('#resourceName').val(resource.name);
								$('#scheme').val(resource.scheme);
								$('#scheme').trigger('change');
								$('#scheme').prop('disabled', true);
								$('#server').val(resource.server);
								$('#port').val(resource.port);
								$('#path').val(resource.path);
								$('#username').val(resource.username);
								$('#password').val(resource.password);
								if(resource.readOnly) {
									$('#readOnly').prop('checked', true);
								}
								if(resource.showHidden) {
									$('#showHidden').prop('checked', true);
								}
								if(resource.showFolders) {
									$('#showFolders').prop('checked', true);
								}
								$('#tabRoles').multipleSelect({
									selected : resource.roles,
									selectedIsObjectList : true,
									resourceKey : 'mount'
								});
							},
							complete : function() {
								loadComplete();
							}
						});

			});
</script>